Thousands of patients prescribed high-risk drugs